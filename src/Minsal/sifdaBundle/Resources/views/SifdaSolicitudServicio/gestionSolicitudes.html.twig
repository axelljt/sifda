{% extends 'MinsalsifdaBundle::layoutResponsable.html.twig' %}

{% block contenido_in -%}
    <div class="page-header">
        <center><h3>Gestion de solicitudes de servicio</h3></center>
    </div>
    <div id="seleccion">
        <div class="row-fluid">
            <div class="span11 offset1">
                <table style="margin-left:70px ">
                <tr>
                    <td style="height: 25px"><input type="radio" name="consulta" id="todos" value="todos" checked>Ingresadas<br></td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td><input type="radio" name="consulta" id="especifico" value="especifico"> Ingresadas Especifico</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td><input type="radio" name="consulta" id="RechTodos" value="RechTodos" checked>Rechazadas</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td style="height: 25px">&nbsp;</td>
                    <td><input type="radio" name="consulta" id="RechEsp" value="RechEspecifico"> Rechazadas Especifico</td>
                </tr>
                
            </table>
                <br>
                <div>
                    <table id="fechas" style="margin-left: 100px">
                        <tr>
                            <td><label>Fecha Inicio: </label></td><td><input type="text" id="fechaInicio" value=""></td>
                            <td><label>Fecha Fin: </label></td><td><input type="text" id="fechaFin" value=""></td>
                            <td><input type="submit" class="btn btn-primary" id="b1" value="Buscar" name="Buscar"></td>
                        </tr>    
                    </table>    
                    <div id="rangoTabla"></div>
                </div>  
                
                
                 {#Cosntruyendo Filtro para Rechazados#}
                
                <div>
                    <table id="Rechfechas" style="margin-left: 100px">
                        <tr>
                            <td><label>Fecha Inicio: </label></td><td><input type="text" id="Rech_fechaInicio" value=""></td>
                            <td><label>Fecha Fin: </label></td><td><input type="text" id="Rech_fechaFin" value=""></td>
                            <td><input type="submit" class="btn btn-primary" id="b2"  value="Buscar" name="Buscar"></td>
                        </tr>    
                    </table>    
                    <div id="rangoRechTabla"></div>
                </div>
                
            </div>
        </div>    
    </div>
        
    <div id="dialog">
        
    </div>
    <br>
    {% if entities%}
    <table id="tabla" class="table table-bordered table-hover table-condensed">
        <thead>
            <tr>
                <th>N°</th>
                <th>Descripcion</th>
                <th>Fecha de recepcion</th>
                <th>Fecha que requiere</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
        {% for entity in entities %}
            <tr>
                {#<td><a href="{{ path('sifda_solicitudservicio_show', { 'id': entity.id }) }}">{{ entity.id }}</a></td>#} 
                <td>{{ loop.index }}</td>
                <td>{{ entity.descripcion }}</td>
                <td>{% if entity.fechaRecepcion %}{{ entity.fechaRecepcion|date('d-m-Y H:i:s') }}{% endif %}</td>
                <td>{% if entity.fechaRequiere %}{{ entity.fechaRequiere|date('d-m-Y') }}{% endif %}</td>
                
                <td>
                <ul>
                    <li>                        
                        <a  href="{{ path('sifda_ordentrabajo_new', { 'id': entity.id }) }}">Crear orden de trabajo</a>
                    </li>
                    <li>                        
                        <a  href="javascript:ShowDialog({{ loop.index }});">Rechazar solicitud de servicio</a>
                        <input type="hidden" id="txt{{ loop.index }}"  value="{{entity.id}}">
                        
                    </li>
                    <li>                        
                        <a  href="{{ path('sifda_solicitudservicio_delete2', { 'id': entity.id }) }} ">Reprogramar solicitud de servicio</a>    
                    </li>
                    
                  </ul>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
        <div id="msgIngresados">
            <center><h4>No se encontraron solicitudes Ingresadas</h4></center>
        </div>
        
    {% endif %}    
        {#Cosntruyendo Tabla para Rechazados#} 
        
        {#<input type="hidden" id="LenRech"  value="{{rechazados.length()}}">#}
        {% if rechazados%}
            
        <table id="RechTabla" class="table table-bordered table-hover table-condensed">
        <thead>
            <tr>
                <th>N°</th>
                <th>Descripcion</th>
                <th>Fecha de recepcion</th>
                <th>Fecha que requiere</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
        {% for rechazado in rechazados %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ rechazado.descripcion }}</td>
                <td>{% if rechazado.fechaRecepcion %}{{ rechazado.fechaRecepcion|date('d-m-Y H:i:s') }}{% endif %}</td>
                <td>{% if rechazado.fechaRequiere %}{{ rechazado.fechaRequiere|date('d-m-Y') }}{% endif %}</td>
                
                <td>
                <ul>
                    
                    <li>                        
                        {#<a  href="{{ path('sifda_solicitudservicio_rechazar', { 'id': entity.id }) }} javascript:confirmar();">Rechazar solicitud de servicio</a>#}
                        {#<a  href="javascript:confirmar({{ loop.index }});">Rechazar solicitud de servicio</a>#}
                        
                            
                        <a  href="javascript:ShowDialog({{ loop.index }});">Aceptar solicitud de servicio</a>
                        <input type="hidden" id="txt{{ loop.index }}"  value="{{rechazado.id}}">
                        
                    </li>
                                       
                  </ul>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
        
    {% else %}
        <div id="msgRechazados">
            <center><h4>No se encontraron solicitudes Rechazadas</h4></center>
        </div>
    {% endif %}     
  {#Fin Tabla para Rechazados#}
        
        <div id="dialogConfirm">
            <span id="spanMessage"></span>

        </div>
         
        
    {% endblock %}

{% block javascripts_step %}
    {{ parent() }}
    <script>
    $(document).ready(function(){


        
        $('#msgIngresados').hide("slow");
        $('#msgRechazados').hide("slow");
        
        document.getElementById('todos').checked=true;
        $('#fechas').hide("slow");
        $('#RechTabla').hide("slow");
        
        
        $('#todos').click(function(){
            $('#fechas').hide("slow");
            $('#tabla').show("slow");
            $('#rangoTabla').hide("slow");
            $('#rangoRechTabla').hide("slow");
            $('#RechTabla').hide("slow");
            $('#msgIngresados').show("slow");
            $('#msgRechazados').hide("slow");
            
        });
        
        $('#especifico').click(function(){ 
        $('#fechas').show("slow");    
        $('#tabla').hide("slow");
        $('#Rechfechas').hide("slow");
        $('#msgRechazados').hide("slow");
        LimpiarCamposFecha();
        
        });
        
        /*Para segunda Busqueda*/
        
        $('#Rechfechas').hide("slow");
     
        $('#RechTodos').click(function(){
            $('#fechas').hide("slow");
            $('#tabla').hide("slow");
            $('#rangoTabla').hide("slow");
            $('#RechTabla').show("slow");
            $('#rangoRechTabla').hide("slow");
            $('#msgIngresados').hide("slow");
            $('#msgRechazados').show("slow");
            
        });
        
        $('#RechEsp').click(function(){ 
        $('#fechas').hide("slow");    
        $('#tabla').hide("slow");  
        $('#rangoTabla').hide("slow");
        $('#Rechfechas').show("slow");
        $('#RechTabla').hide("slow");
        $('#msgIngresados').hide("slow");
        $('#msgRechazados').hide("slow");
        LimpiarCamposFecha();
        
        });
       
        
        
        $("#b1").click(function(){
           
            var fi = $("#fechaInicio").val();
            var ff = $("#fechaFin").val();
            $.post(
            '{{path('sifda_solicitudservicio_buscar_solicitudes_ingresadas')}}', 
              { 
                fechaInicio:$("#fechaInicio").val(),
                fechaFin   :$("#fechaFin").val()
              }
              , function( data ) {
                console.log( data );
                    $("#rangoTabla").html(data);
                
             }, "json");
            
            $('#msgIngresados').show("slow");
        });
        
        
            
            $("#b2").click(function() {
                $.post(
                    '{{path('sifda_solicitudservicio_buscar2_solicitudes')}}', 
                    { 
                      fechaInicio:$("#Rech_fechaInicio").val(),
                      fechaFin   :$("#Rech_fechaFin").val()
                    }
                        , function( data ) {
                           console.log( data );
                         $("#rangoRechTabla").html(data);
                
                    }, "json");
            
                    $('#msgRechazados').show("slow");
            });
            
        
    });
    
    
    
    $.datepicker.regional['es'] = {
			 closeText: 'Cerrar',
			 prevText: '<Ant',
			 nextText: 'Sig>',
			 currentText: 'Hoy',
			 monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
			 monthNamesShort: ['Ene','Feb','Mar','Abr', 'May','Jun','Jul','Ago','Sep', 'Oct','Nov','Dic'],
			 dayNames: ['Domingo', 'Lunes', 'Martes', 'Mi�rcoles', 'Jueves', 'Viernes', 'S�bado'],
			 dayNamesShort: ['Dom','Lun','Mar','Mi�','Juv','Vie','S�b'],
			 dayNamesMin: ['Do','Lu','Ma','Mi','Ju','Vi','S�'],
			 weekHeader: 'Sm',
			 showButtonPanel:false,
			 showAnim:'show',
                         changeMonth: true,
			 changeYear: true,
                         {#minDate: new Date(2014, 1, 1), 
                         maxDate: "1D",#}
                         dateFormat: 'yy-mm-dd',
			 firstDay: 1,
			 isRTL: false,
			 showMonthAfterYear: false,
			 			                         
                         onClose: function (selectedDate) {
                         
                          $("#fechaInicio").datepicker("option", "maxDate", selectedDate);
                          $("#fechaFin").datepicker("option", "minDate", selectedDate);
                          
                         },
                         
                         yearSuffix: ''
                         
			 };
			$.datepicker.setDefaults($.datepicker.regional['es']);
			$(function() {
				$( "#fechaInicio" ).datepicker(
					
					);
                                
                                $( "#fechaFin" ).datepicker(
					
					);
                                $( "#Rech_fechaInicio" ).datepicker(
					
					);
                                
                                $( "#Rech_fechaFin" ).datepicker(
					
					);
                                
                                
				}); 
                                       
       
    function confirmar(valor){ 
        
        {#var id= $("#txt"+valor).val();#}
        
        {#alert('id enviado: '+id);#}
        confirmar=confirm("Desea Rechazar la Solicitud?"); 
        if (confirmar)
            LlamarControlador('{{path('sifda_solicitudservicio_rechazar')}}',$("#txt"+valor).val());
        // si pulsamos en aceptar
            {#{
                $.post(
                '{{path('sifda_solicitudservicio_rechazar')}}',         
                 { 
                    id:$("#txt"+valor).val(),
                    
                 }
                 , function( data ) {
                console.log( data );
                    $("#rangoTabla").html(data);
                
             }, "json");      
             
             alert("Solicitud Rechazada Exitosamente ");
            }#}
           {# alert('{{path(sifda_solicitudservicio_rechazar),'id':}}');   
           '{{ path('sifda_solicitudservicio_rechazar', { 'id': valor }) }}';#}
         
        
        else 
        // si pulsamos en cancelar
        alert('Has dicho que no'); 
    
    
}  
    
    function LlamarControlador(url,valor)
    {
        $.post(
            url,
            {
                id:valor,
            }).done(function(){
                {#alert("Solicitud Rechazada Exitosamente");#}
                 window.location='{{path('sifda_gestionSolicitudes')}}';   
                ('#dialog').attr('title','Confirmacion').text('Solicitud Rechazada Correctamente').dialog();               
                
            });
    }
    
    
    /*Codigo para nueva ventana*/
  function ShowDialog(valor) {
  
    alert(valor);
    alert($("#txt"+valor).val());
    
        $('#spanMessage').html('¿Está seguro(a) de Rechazar la Solicitud?');
        $("#dialogConfirm").dialog({
            resizable: false,
            height: 160,
            width: 300,
            modal: true,
            title: 'Confirmacion',
            buttons: {
                'Aceptar': function () {
                    {#alert('{{path('sifda_solicitudservicio_rechazar')}}');#}
                    {#alert($("#txt"+valor).val());#}
                    LlamarControlador('{{path('sifda_solicitudservicio_rechazar')}}',$("#txt"+valor).val());
                    {#$("<div><span>Solicitud Rechazada correctamente</span></div>").appendTo(document.body);#}
                    $(this).dialog("close");
                },
                    'Cancelar': function () {
                    $(this).dialog("close");
                }
            }
        });
    }
    
    /*Fin del codigo de ventana*/
   
   function LimpiarCamposFecha(){
            
        document.getElementById('fechaInicio').value="";
        document.getElementById('fechaFin').value="";
        document.getElementById('Rech_fechaInicio').value="";
        document.getElementById('Rech_fechaFin').value="";
    }
    
    </script>
    {% endblock%}
    
   